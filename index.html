<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Calculator Test</title>
    </head>
    <body>
        <h1>Calculator Test</h1>
        <div id="output"></div>
        <div class=spinner id=spinner></div>
        <div class=emscripten id=status>Downloading...</div>
        <span id=controls>
          <span>
            <input type=checkbox id=resize>Resize canvas
          </span> 
          <span>
            <input type=checkbox id=pointerLock checked>Lock/hide mouse pointer    
          </span>
          <span>
            <input type=button onclick='Module.requestFullscreen(document.getElementById("pointerLock").checked,document.getElementById("resize").checked)'value=Fullscreen>
          </span>
        </span>
        <div class=emscripten>
          <progress hidden id=progress max=100 value=0></progress>
        </div>
        <div class=emscripten_border>
          <canvas class=emscripten id=canvas oncontextmenu=event.preventDefault() tabindex=-1></canvas>
        </div>
        <textarea id=output rows=8></textarea>
        <script>
          WebAssembly.instantiateStreaming(
            fetch('out/build/x64-debug/Das2Wasm/Das2Wasm.wasm'),
          ).then(result => {
            const add = result.instance.exports.add;
            const sub = result.instance.exports.sub;
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = `
              <p>Addition result: ${add(1, 2)}</p>
              <p>Subtraction result: ${sub(2, 1)}</p>
            `;
          });
        </script>
        <script src="./Test.js"></script>
        <script>
          var statusElement=document.getElementById("status"),
          progressElement=document.getElementById("progress"),
          spinnerElement=document.getElementById("spinner"),
          Module={print:function(){
            var e=document.getElementById("output");
            return e&&(e.value=""),
            (...t)=>{
              var n=t.join(" ");console.log(n),
              e&&(e.value+=n+"\n",e.scrollTop=e.scrollHeight)
            }
          }(),
          canvas:(()=>{
            var e=document.getElementById("canvas");
            return e.addEventListener("webglcontextlost",
            (e=>{
              alert("WebGL context lost. You will need to reload the page."),
              e.preventDefault()
            }),
            !1),
            e
          })(),
          setStatus:e=>{
            if(Module.setStatus.last??={time:Date.now(),text:""},e!==Module.setStatus.last.text)
            {
              var t=e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/),
              n=Date.now();
              t&&n-Module.setStatus.last.time<30||
              (Module.setStatus.last.time=n,
              Module.setStatus.last.text=e,t?(e=t[1],progressElement.value=100*parseInt(t[2]),
              progressElement.max=100*parseInt(t[4]),progressElement.hidden=!1,spinnerElement.hidden=!1)
              :
              (progressElement.value=null,
              progressElement.max=null,
              progressElement.hidden=!0,e||(spinnerElement.style.display="none")),
              statusElement.innerHTML=e)
            }
          },
          totalDependencies:0,
          monitorRunDependencies:e=>{
            this.totalDependencies=Math.max(this.totalDependencies,e),
            Module.setStatus(e?"Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")":"All downloads complete.")
          }};
          Module.setStatus("Downloading..."),
          window.onerror=e=>{
            Module.setStatus("Exception thrown, see JavaScript console"),
            spinnerElement.style.display="none",
            Module.setStatus=e=>{e&&console.error("[post-exception status] "+e)}
          }
        </script>
        <script async src=out/build/x64-debug/Das2Wasm/Das2Wasm.js></script>
    </body>
</html>